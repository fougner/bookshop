/*
*
*	Author: Alexander Fougner
*
*
*/

DROP TABLE IF EXISTS PRODUCTS_COMPONENTS, ORDER_ITEMS, ORDERS, COMPONENTS, PRODUCTS CASCADE;

CREATE TABLE COMPONENTS(
	COMPONENT_ID INT  NOT NULL AUTO_INCREMENT, 
	TITLE VARCHAR(200), 
	DESCRIPTION TEXT, 
	PRICE NUMERIC(5,2),
	QTY INT,
	PRIMARY KEY(COMPONENT_ID)
	/* FOREIGN KEY(AUTHOR_ID) REFERENCES AUTHORS(AUTHOR_ID)*/
);

CREATE TABLE PRODUCTS(
	PRODUCT_ID INT  NOT NULL AUTO_INCREMENT, 
	TITLE VARCHAR(200), 
	DESCRIPTION TEXT, 
	PRICE NUMERIC(5,2), 
	PRIMARY KEY(PRODUCT_ID)
	-- FOREIGN KEY(AUTHOR_ID) REFERENCES AUTHORS(AUTHOR_ID)
);

-- Many to many relationship between products and components.

CREATE TABLE PRODUCTS_COMPONENTS(
	ID INT NOT NULL AUTO_INCREMENT,
	PRODUCT_ID INT NOT NULL,
	COMPONENT_ID INT NOT NULL,
	PRIMARY KEY(ID),
	FOREIGN KEY(PRODUCT_ID) REFERENCES PRODUCTS(PRODUCT_ID),
	FOREIGN KEY(COMPONENT_ID) REFERENCES COMPONENTS(COMPONENT_ID)
);


-- ONE ORDER MAY CONTAIN A LOT OF PRODUCTS
-- CREATE UNIQUE SEQUENCE ORDER_ID_SEQ;

CREATE TABLE ORDERS(
	ORDER_ID INT NOT NULL AUTO_INCREMENT,
	BUYER_NAME VARCHAR(100),
	SHIPPING_ADRESS VARCHAR(100),
	SHIPPING_ZIPCODE VARCHAR(10),
	SHIPPING_CITY VARCHAR(30),
	PRIMARY KEY(ORDER_ID)
);

-- EACH DISTINCT ORDER ITEMS	
-- CREATE UNIQUE SEQUENCE ORDER_ITEM_ID_SEQ;

CREATE TABLE ORDER_ITEMS(
	ORDER_ITEM_ID INT NOT NULL AUTO_INCREMENT,
	ORDER_ID INT,
	PRODUCT_ID INT,
	QUANTITY INT,
	PRIMARY KEY(ORDER_ITEM_ID),
	FOREIGN KEY(ORDER_ID) REFERENCES ORDERS(ORDER_ID),
	FOREIGN KEY(PRODUCT_ID) REFERENCES PRODUCTS(PRODUCT_ID)
);


/*
*
*		SOME EXAMPLE DATA
*
*/

INSERT INTO PRODUCTS(PRODUCT_ID, TITLE, DESCRIPTION, PRICE) 
	VALUES(1, 'HAVREFLARN', 'Ett mumsigt HAVREFLARN av högsta kvalité', 60),
	(2, 'CHOKLADBOLLAR', 'Den klassiska chokladbollen, älskad av många, hatad av få.', 50);

INSERT INTO COMPONENTS(COMPONENT_ID, TITLE, DESCRIPTION, PRICE, QTY)
	VALUES(1, 'HAVRE', 'Havre av högsta kvalité', 10, 10),
	(2, 'FLARN', 'Flarn av högsta kvalité', 25, 12),
	(3, 'CHOKLAD', 'Choklad av högsta kvalité', 12, 50),
	(4, 'BOLLAR', 'Bollar av högsta kvalité', 40, 20);

INSERT INTO PRODUCTS_COMPONENTS(PRODUCT_ID, COMPONENT_ID)
	VALUES(1,1),
	(1,2),
	(2,3),
	(2,4);


/*
*
*		AUTHENTICATION
*
*/



DROP TABLE IF EXISTS USERS, USER_ROLES CASCADE;

create table USERS(
       USER_NAME varchar(15) not null primary key,
       USER_PASS varchar(15) not null,
       NAME varchar(100) not null,
       STREET_ADDRESS varchar(100)not null,
       ZIP_CODE varchar(10) not null,
       CITY varchar(30) not null,
       COUNTRY varchar(30) not null
);

create table USER_ROLES(
	USER_NAME varchar(15) not null,
	ROLE_NAME varchar(15) not null,
	primary key (USER_NAME, ROLE_NAME)
);

insert into USERS(USER_NAME, USER_PASS, NAME, STREET_ADDRESS, ZIP_CODE, CITY, COUNTRY) 
     VALUES('tomcat','tacmot','Tom Cat','Apache Road', '34 567', 'Petaluma', 'USA');
insert into USERS(USER_NAME, USER_PASS, NAME, STREET_ADDRESS, ZIP_CODE, CITY, COUNTRY) 
     VALUES('gyro','glurk','Gyro Gearloose','Duck Road', '78 901', 'Ducksbury', 'USA');
insert into USERS(USER_NAME, USER_PASS, NAME, STREET_ADDRESS, ZIP_CODE, CITY, COUNTRY) 
     VALUES('admin', 'glurk','System user', 'Polacksbacken', '752 37', 'Uppsala', 'Sweden');

insert into USER_ROLES(USER_NAME, ROLE_NAME) VALUES('tomcat','tomcat');
insert into USER_ROLES(USER_NAME, ROLE_NAME) VALUES('gyro', 'tomcat');
insert into USER_ROLES(USER_NAME, ROLE_NAME) VALUES('admin','manager');
insert into USER_ROLES(USER_NAME, ROLE_NAME) VALUES('admin','admin');
insert into USER_ROLES(USER_NAME, ROLE_NAME) VALUES('admin','tomcat');